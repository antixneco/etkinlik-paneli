<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Etkinlik Paneli ve Masalar</title>
    <style>
        body { font-family: Arial; }
        h2 { margin-top: 30px; }

        /* Tablo stili */
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        table, th, td { border: 1px solid black; }
        th, td { padding: 5px; text-align: left; }

        /* Masa düzeni stili */
        .masa-alani { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
        .masa { border: 2px solid #333; border-radius: 10px; padding: 10px; width: 200px; min-height: 250px; background: #f9f9f9; }
        .masa h3 { text-align: center; }
        .katilimci-list { list-style: none; padding: 0; margin: 0; }
        .katilimci-list li { padding: 5px; margin: 2px 0; border: 1px solid #999; border-radius: 5px; cursor: grab; background: #fff; }
        .plaket { background-color: gold; font-weight: bold; }
    </style>
</head>
<body>

<h1>Etkinlik Katılım Paneli</h1>

<!-- Katılım Formu -->
<h2>Etkinlik Katılım Formu</h2>
<form id="katilimForm">
    <label>Ad Soyad:</label><br>
    <input type="text" name="adSoyad" required><br><br>

    <label>Plaket alıyor mu?</label><br>
    <select name="plaket" required>
        <option value="">Seçiniz</option>
        <option value="Evet">Evet</option>
        <option value="Hayır">Hayır</option>
    </select><br><br>

    <label>Yanında kimler geliyor?</label><br>
    <input type="text" name="yaninda" placeholder="Eş, Çocuk, Misafir sayısı"><br><br>

    <label>Konaklama istiyor mu?</label><br>
    <select name="konaklama" required>
        <option value="">Seçiniz</option>
        <option value="Evet">Evet</option>
        <option value="Hayır">Hayır</option>
    </select><br><br>

    <label>Konaklayacak kişi sayısı:</label><br>
    <input type="number" name="konaklamaSayisi" min="0"><br><br>

    <button type="submit">Gönder</button>
</form>

<!-- Katılımcı Tablosu -->
<h2>Katılımcı Listesi</h2>
<table id="katilimTablo">
    <tr>
        <th>Ad Soyad</th>
        <th>Plaket</th>
        <th>Yanında</th>
        <th>Konaklama</th>
        <th>Konaklayacak kişi sayısı</th>
    </tr>
</table>
<button id="indirBtn">Katılımcıları CSV Olarak İndir</button>

<!-- Masa Alanı -->
<h2>Masalar</h2>
<div class="masa-alani" id="masaAlani"></div>

<!-- Sortable.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){
    // ===== Masaları oluştur =====
    const masaAlani = document.getElementById('masaAlani');
    const masaSayisi = 5; // Başlangıçta 5 masa
    const kisiPerMasa = 10; // Her masa 10 kişilik olacak
    const masalar = [];

    // Masaları başlat
    for (let i = 1; i <= masaSayisi; i++) {
        const masaDiv = document.createElement('div');
        masaDiv.classList.add('masa');
        masaDiv.id = `masa${i}`;
        masaDiv.innerHTML = `<h3>Masa ${i}</h3><ul class="katilimci-list" id="masa${i}list"></ul>`;
        masaAlani.appendChild(masaDiv);
        masalar.push(masaDiv.querySelector('.katilimci-list'));

        // Her masa için ayrı Sortable.js başlat
        new Sortable(masaDiv.querySelector('.katilimci-list'), {
            group: "masalar", // Masalar arasında taşınabilir
            animation: 150,   // Taşıma animasyonu
            onEnd: function(evt) {
                // Taşıma sonrasında yapılacak işlemler
                console.log(`Masa ${i} taşındı.`);
            }
        });
    }

    // ===== LocalStorage'dan yükleme =====
    let kayitliKatilimcilar = JSON.parse(localStorage.getItem('katilimcilar') || '[]');
    kayitliKatilimcilar.forEach(k => {
        tabloyaVeMasayaEkle(k);
    });

    // ===== Formdan veri ekleme =====
    document.getElementById('katilimForm').addEventListener('submit', function(e){
        e.preventDefault();

        const adSoyad = this.querySelector('input[name="adSoyad"]').value;
        const plaket = this.querySelector('select[name="plaket"]').value;
        const yaninda = this.querySelector('input[name="yaninda"]').value;
        const konaklama = this.querySelector('select[name="konaklama"]').value;
        const konaklamaSayisi = this.querySelector('input[name="konaklamaSayisi"]').value;

        const katilimci = {adSoyad, plaket, yaninda, konaklama, konaklamaSayisi};
        
        // Tabloya ve masaya ekle
        tabloyaVeMasayaEkle(katilimci);

        // LocalStorage'a kaydet
        kayitliKatilimcilar.push(katilimci);
        localStorage.setItem('katilimcilar', JSON.stringify(kayitliKatilimcilar));

        this.reset();
    });

    function tabloyaVeMasayaEkle(k){
        // Tablo
        const tablo = document.getElementById('katilimTablo');
        const yeniSatir = tablo.insertRow();
        yeniSatir.insertCell(0).innerText = k.adSoyad;
        yeniSatir.insertCell(1).innerText = k.plaket;
        yeniSatir.insertCell(2).innerText = k.yaninda;
        yeniSatir.insertCell(3).innerText = k.konaklama;
        yeniSatir.insertCell(4).innerText = k.konaklamaSayisi;

        // Masalara ekle
        const li = document.createElement('li');
        li.innerText = k.adSoyad;
        if(k.plaket === "Evet") li.classList.add('plaket');

        let eklendi = false;
        for (let masa of masalar){
            if(masa.children.length < kisiPerMasa){
                masa.appendChild(li);
                eklendi = true;
                break;
            }
        }

        if(!eklendi){
            alert("Tüm masalar dolu! Yeni masa eklemeniz gerekiyor.");
        }
    }

    // ===== CSV indirme =====
    document.getElementById('indirBtn').addEventListener('click', function(){
        const tablo = document.getElementById('katilimTablo');
        let csv = [];

        for(let i=0; i<tablo.rows.length; i++){
            let satir = [];
            for(let j=0; j<tablo.rows[i].cells.length; j++){
                let hucre = tablo.rows[i].cells[j].innerText.replace(/"/g,'""');
                satir.push(`"${hucre}"`);
            }
            csv.push(satir.join(","));
        }

        const csvString = "\uFEFF" + csv.join("\n");
        const csvDosya = new Blob([csvString], { type:'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(csvDosya);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'katilim.csv';
        a.click();
        URL.revokeObjectURL(url);
    });

});
</script>

</body>
</html>
